## In this project, I want to download history data and make a dataset for the Tehran Stock Exchange (TSE). TSE dont share all data into internet free

## Iran stock websites:
- [بورس اوراق بهادار تهران](http://tse.ir/)
- [پایگاه خبری بازار سرمایه ایران](http://www.sena.ir/)
- [سامانه جامع اطلاع رسانی ناشران](https://www.codal.ir/)
- [سازمان بورس و اوراق](https://www.seo.ir/)
- [قیمت های بورس](http://www.tsetmc.com)

## Example
For test select bank melat symbol:

[Main Page](http://www.tsetmc.com/Loader.aspx?ParTree=15)
[بانك ملت (وبملت)](http://www.tsetmc.com/Loader.aspx?ParTree=151311&i=778253364357513#)

	Bank Melat SYMBOL_ID = 778253364357513

### Today Data
	URI
	http://www.tsetmc.com/Loader.aspx?ParTree=151311&i=SYMBOL_ID

	Sample
	http://www.tsetmc.com/Loader.aspx?ParTree=151311&i=778253364357513

### Get History Data
	URI
	http://cdn.tsetmc.com/Loader.aspx?ParTree=15131P&i=SYMBOL_ID&d=YEAR,MONTH,DAY
	Sample:
	http://cdn.tsetmc.com/Loader.aspx?ParTree=15131P&i=778253364357513&d=20180212

The TSETMC website developers use a javascript function with name ens for adding javascript files into HTML document.

Three javascript files used for handled HTML functionality:
- http://cdn.tsetmc.com/tsev2/res/loader.aspx?t=j&_443
- http://cdn.tsetmc.com/tsev2/res/loader.aspx?t=s&_443
- http://cdn.tsetmc.com/tsev2/res/loader.aspx?t=h&_443

In the HTML document, defined different variables are used in javascript functions

	var InstSimpleData = [
			0 'بانك ملت',
			1 'وبملت',
			2 'بازار بورس',
			3 'بازار اول (تابلوي اصلي) بورس',
			4 1,
			5 'N1',
			6 'IRO1BMLT0007',
			7 'IRO1BMLT0001',
			8 50000000000,
			9 9569378
			];
	var LVal30         = InstSimpleData[0]; **SYMBOL_NAME**
	var LVal18AFC      = InstSimpleData[1]; **SYMBOL**
	var FlowName       = InstSimpleData[3]; **TABLUE***
	var Flow           = InstSimpleData[4]; **???***
	var CgrValCot      = InstSimpleData[5]; **???***
	var InstrumentID   = InstSimpleData[7]; **???***
	var ZTitad         = InstSimpleData[8]; **???***
	var BaseVol        = InstSimpleData[9]; **???***
	var InsCode        = '778253364357513'; **SYMBOL_ID**
	var CIsin          = '';
	var PdrCotVal      = '';
	var PClosing       = ''; 
	var DEven          = '20180212';

	var StaticTreshholdData =[
		[    1,1097.00,993.00],
		[60124,1097.00,993.00]
	];

	var ClosingPriceData = [
		['1396/11/23 06:10:47','-','1046','1045',   '0','1045',   '0',   '0','0',   '0',       '0', '0','61047'],
		['1396/11/23 09:00:10','-','1045','1045','1045','1045','1045','1045','1','2830', '2957350', '0','90010'],
		['1396/11/23 09:08:13','-','1040','1045','1045','1045','1045','1040','2','32230','33533350','0','90813'],
		['1396/11/23 09:12:07','-','1040','1045','1045','1045','1045','1040','3','33230','34573350','0','91207'],
		['1396/11/23 09:12:19','-','1040','1045','1045','1045','1045','1040','4','33240','34583750','0','91219'],
		['1396/11/23 09:19:52','-','1040','1045','1045','1045','1045','1040','5','39830','41437350','0','91952'],
		['1396/11/23 09:19:52','-','1040','1045','1045','1045','1045','1040','6','44830','46637350','0','91952'],
		['1396/11/23 09:19:52','-','1040','1045','1045','1045','1045','1040','7','45740','47583750','0','91952'],
		['1396/11/23 09:21:17','-','1044','1045','1045','1045','1045','1040','8','46420','48293670','0','92117'],
		...
	]

	var IntraDayPriceData=[
			['09:00',1045,1040,1045,1040,32230  ],
			['09:12',1040,1040,1040,1040,13510  ],
			['09:21',1044,1040,1044,1040,137299 ],
			['09:33',1040,1033,1040,1036,99436  ],
			['09:40',1035,1033,1035,1035,126000 ],
			['09:53',1035,1035,1035,1035,19580  ],
			['10:04',1039,1035,1039,1039,9000   ],
			['10:14',1040,1039,1039,1039,600000 ],
			['10:22',1040,1040,1040,1040,446312 ],
			['10:32',1040,1037,1037,1037,39536  ],
			['10:42',1040,1037,1037,1038,31722  ],
			['10:52',1037,1036,1037,1036,155322 ],
			['11:14',1036,1035,1036,1035,140313 ],
			['11:20',1035,1034,1035,1034,570913 ],
			['11:30',1036,1034,1036,1036,50000  ],
			['11:47',1036,1034,1035,1034,11224  ],
			['11:56',1035,1033,1035,1033,140000 ],
			['12:07',1035,1030,1035,1031,1438218],
			['12:16',1036,1031,1035,1032,510201 ]
		];

	var InstrumentStateData = [[20170820,1,'A ']];

	var IntraTradeData = [
		['1','09:00:14',  '2830','1045',0],
		['2','09:08:18',' 29400','1040',0],
		['3','09:12:12',  '1000','1040',0],
		['4','09:12:24',    '10','1040',0],
		['5','09:19:57',  '6590','1040',0],
		['6','09:19:57',  '5000','1040',0],
		['7','09:19:57',   '910','1040',0],
		['8','09:21:22',   '680','1044',0],
		['9','09:22:04',  '6320','1044',0],
		['10','09:23:52', '1429','1043',0],
		['11','09:24:05', '2000','1041',0],
		['12','09:24:05', '3870','1040',0],
		['13','09:24:05','94130','1040',0],
		...
		['24','09:41:10','25000','1035',0],
		['25','09:45:31','12500','1035',0]
	];

	var ShareHolderData=[
			[
				44141,
				'IRO1BMLT0007',
				8499999996,
				16.990,
				'',
				'دولت جمهوري اسلامي ايران'
			],
			[
				965,
				'IRO1BMLT0007',
				2499999999,
				4.990,
				'',
				'صندوق تامين آتيه كاركنان بانك ملت'
			],
			[
				490,
				'IRO1BMLT0007',
				2111338711,
				4.220,
				'',
				'شركت سرمايه گذاري صباتامين-سهامي عام-'
			],
			[
				99,
				'IRO1BMLT0007',
				1904782481,
				3.800,
				'',
				'سازمان تامين اجتماعي'
			],
			[
				1064,
				'IRO1BMLT0007',
				1525595446,
				3.050,
				'',
				'شركت س اتهران س.خ-م ك م ف ع-'
			],
			[
				21470,
				'IRO1BMLT0007',
				1450719028,
				2.900,
				'',
				'شركت تعاوني معين آتيه خواهان'
			],
			[
				44378,
				'IRO1BMLT0007',
				1326987218,
				2.650,
				'ArrowUp',
				'BFMصندوق سرمايه گذاري.ا.بازارگرداني ملت'
			],
			[
				1065,
				'IRO1BMLT0007',
				1217728923,
				2.430,
				'',
				'شركت س اخراسان رضوي س.خ-م ك م ف ع-'
			],
			[
				2674,
				'IRO1BMLT0007',
				1032597703,
				2.060,
				'',
				'شركت س افارس س.خ-م ك م ف ع-'
			],
			[
				8113,
				'IRO1BMLT0007',
				1030785229,
				2.060,
				'ArrowUp',
				'شركت گروه مالي ملت-سهام عام-'
			],
			[
				44516,
				'IRO1BMLT0007',
				952360382,
				1.900,
				'',
				'شركت سرمايه گذاري مدبران اقتصاد-سهامي خاص-'
			],
			[
				1063,
				'IRO1BMLT0007',
				941458365,
				1.880,
				'',
				'شركت س ااصفهان س.خ-م ك م ف ع-'
			],
			[
				2662,
				'IRO1BMLT0007',
				921606612,
				1.840,
				'',
				'شركت س اخوزستان س.خ-م ك م ف ع-'
			],
			[
				22399,
				'IRO1BMLT0007',
				863131153,
				1.720,
				'',
				'شركت گروه مالي ملت-سهامي عام-بخش1'
			],
			[
				21630,
				'IRO1BMLT0007',
				792000000,
				1.580,
				'',
				'شركت گروه توسعه مالي مهرآيندگان-سهامي عام-'
			],
		];

	var ShareHolderDataYesterday =[
		[
			44141,'IRO1BMLT0007',8499999996,16.990,'','دولت جمهوري اسلامي ايران'
			965,'IRO1BMLT0007',2499999999,4.990,'','صندوق تامين آتيه كاركنان بانك ملت'
			490,'IRO1BMLT0007',2111338711,4.220,'','شركت سرمايه گذاري صباتامين-سهامي عام-'
			99,'IRO1BMLT0007',1904782481,3.800,'','سازمان تامين اجتماعي'
			1064,'IRO1BMLT0007',1525595446,3.050,'','شركت س اتهران س.خ-م ك م ف ع-'
			21470,'IRO1BMLT0007',1450719028,2.900,'','شركت تعاوني معين آتيه خواهان'
			44378,'IRO1BMLT0007',1326656283,2.650,'ArrowUp','BFMصندوق سرمايه گذاري.ا.بازارگرداني ملت'
			1065,'IRO1BMLT0007',1217728923,2.430,'','شركت س اخراسان رضوي س.خ-م ك م ف ع-'
			2674,'IRO1BMLT0007',1032597703,2.060,'','شركت س افارس س.خ-م ك م ف ع-'
			8113,'IRO1BMLT0007',1030492460,2.060,'ArrowUp','شركت گروه مالي ملت-سهام عام-'
			44516,'IRO1BMLT0007',952360382,1.900,'','شركت سرمايه گذاري مدبران اقتصاد-سهامي خاص-'
			1063,'IRO1BMLT0007',941458365,1.880,'','شركت س ااصفهان س.خ-م ك م ف ع-'
			2662,'IRO1BMLT0007',921606612,1.840,'','شركت س اخوزستان س.خ-م ك م ف ع-'
			22399,'IRO1BMLT0007',863131153,1.720,'','شركت گروه مالي ملت-سهامي عام-بخش1'
			21630,'IRO1BMLT0007',792000000,1.580,'','شركت گروه توسعه مالي مهرآيندگان-سهامي عام-'
			2663,'IRO1BMLT0007',777907910,1.550,'','شركت س اآذربايجان شرقي س.خ-م ك م ف ع-'
			2675,'IRO1BMLT0007',725746772,1.450,'','شركت س امازندران س.خ-م ك م ف ع-'
			21318,'IRO1BMLT0007',724703140,1.440,'','صندوق تامين آتيه كاركنان بانك ملت-بخش1دارايي-'
			307,'IRO1BMLT0007',720612912,1.440,'','شركت پخش سراسري ايران سهامي خاص'
			2665,'IRO1BMLT0007',707520623,1.410,'','شركت س اكرمان س.خ-م ك م ف ع-'
			20910,'IRO1BMLT0007',705298757,1.410,'','صندوق سرمايه گذاري يكم كارگزاري بانك كشاورزي'
			2666,'IRO1BMLT0007',654789078,1.300,'','شركت س اگيلان س.خ-م ك م ف ع-'
			20062,'IRO1BMLT0007',612630346,1.220,'','شركت سرمايه گذاري اهداف-سهامي عام-'
			48471,'IRO1BMLT0007',604246528,1.200,'','شركت شيرين عسل-سهامي خاص-'
			527,'IRO1BMLT0007',570657471,1.140,'','شركت سرمايه گذاري ملي ايران-سهامي عام-'
			2676,'IRO1BMLT0007',567032348,1.130,'','شركت س اآذربايجان غربي س.خ-م ك م ف ع-'
			2667,'IRO1BMLT0007',547327808,1.090,'','شركت س اسيستان وبلوچستان س.خ-م ك م ف ع-'
		];

### Analysis HTML and Javascript Files
	StaticTreshholdData
		[
			[1,2497.00, 2261.00],
			[60124, 2483.00, 2247.00]
		]
	ClosingPriceData
		[
		C1	آخرین معامله
		C2	قیمت پایانی
		C3	اولین قیمت
		C4	قیمت دیروز

		DateTime               X   C1     C2     C3     C4     Low    High  ID   C5       C6
		'1397/11/17 09:00:20','-','2430','2367','2430','2365','2430','2430','1','100000','243000000','0','90020'
		'1397/11/17 09:00:20','-','2430','2368','2430','2365','2430','2430','2','200000','486000000','0','90020'
		'1397/11/17 09:00:20','-','2430','2370','2430','2365','2430','2430','3','300000','729000000','0','90020'
		'1397/11/17 09:00:20','-','2430','2372','2430','2365','2430','2430','4','400000','972000000','0','90020'

		'1397/11/17 09:00:21','-','2430','2373','2430','2365','2430','2430','5','500000','1215000000','0','90021'
		'1397/11/17 09:00:21','-','2430','2374','2430','2365','2430','2430','6','570000','1385100000','0','90021'
		'1397/11/17 09:00:21','-','2430','2375','2430','2365','2430','2430','7','623044','1513996920','0','90021'
		'1397/11/17 09:00:21','-','2430','2376','2430','2365','2430','2430','8','673044','1635496920','0','90021'
		'1397/11/17 09:00:21','-','2430','2377','2430','2365','2430','2430','9','723044','1756996920','0','90021'

		'1397/11/17 09:00:21','-','2430','2378','2430','2365','2430','2430','10','773044','1878496920','0','90021'
		'1397/11/17 09:00:21','-','2430','2378','2430','2365','2430','2430','11','808544','1964761920','0','90021'
		'1397/11/17 09:00:21','-','2430','2379','2430','2365','2430','2430','12','840044','2041306920','0','90021'
		'1397/11/17 09:00:21','-','2430','2379','2430','2365','2430','2430','13','860044','2089906920','0','90021'

	
ii.OneDayBL = BestLimitData
	#blhb خرید
	#blhs فروش	
	زمان  تعداد  حجم  قیمت

	var BestLimitData =
		[
			2,3,4
			5,6,7
			   0    1   2     3       4      5      6     7
					Buyer               Seller
				   ------------------   ----------------
			            cnt  vol     price  price   vol   cnt
			[60122,'1','1','16145', '2371','2400','9000', '2'],
			[60122,'2','6','550000','2322','2430','1000', '1'],
			[60122,'3','2','947',   '2310','2440','10000','1'],
			[60122,'4','1','100000','2308','2445','50000','1'],
			[60122,'5','1','10000', '2306','2447','50500','2'],

			[83007,'2','1','5000',  '2350','2430','1000', '1'],
			[83007,'3','6','550000','2322','2440','10000','1'],
			[83007,'4','2','947',   '2310','2445','50000','1'],
			[83007,'5','1','100000','2308','2447','50500','2'],

			[83052,'1','1','16145', '2371','2400','9376', '3'],

			[83107,'2','1','5000',  '2350','2424','30000','1'],
			[83107,'3','6','550000','2322','2430','1000', '1'],
			[83107,'4','2','947',   '2310','2440','10000','1'],
			[83107,'5','1','100000','2308','2445','50000','1'],

			[83110,'4','2','947',   '2310','2440','20000','2'],
			[83142,'2','2','6524',  '2350','2424','30000','1'],
			[83152,'1','1','16145', '2371','2396','934',  '1'],
			[83152,'2','2','6524',  '2350','2400','9376', '3'],
			[83152,'3','6','550000','2322','2424','30000','1'],
			[83152,'4','2','947',   '2310','2430','1000', '1'],
			[83152,'5','1','100000','2308','2440','20000','2'],
			[83206,'3','6','550000','2322','2423','1000', '1'],
			[83206,'4','2','947',   '2310','2424','30000','1'],
			[83227,'4','1','50000', '2320','2424','30000','1'],
			[83227,'5','2','947',   '2310','2440','20000','2'],
			[83252,'3','6','550000','2322','2410','500',  '1'],
			[83252,'4','1','50000', '2320','2423','1000', '1'],
			[83252,'5','2','947',   '2310','2424','30000','1'],
		]
ii.OneDayCP = ClosingPriceData
	ClosingPriceData=[
			['1397/11/21 06:10:55','-','2380','2396','0',   '2396','0',   '0',   '0','0',    '0',        '0','61055'],
			['1397/11/21 09:00:22','-','2390','2396','2390','2396','2390','2390','1','20000','47800000', '0','90022'],
			['1397/11/21 09:00:22','-','2390','2396','2390','2396','2390','2390','2','21500','51385000', '0','90022'],
			['1397/11/21 09:00:59','-','2381','2396','2390','2396','2390','2381','3','23500','56147000', '0','90059'],
			['1397/11/21 09:00:59','-','2381','2396','2390','2396','2390','2381','4','53500','127577000','0','90059'],
			['1397/11/21 09:00:59','-','2381','2396','2390','2396','2390','2381','5','73500','175197000','0','90059'],

ii.OneDayTH = StaticTreshholdData
ii.OneDayIS = InstrumentStateData
ii.OneDayIT = IntraTradeData
ii.OneDaySH = ShareHolderData
ii.OneDaySY = ShareHolderDataYesterday
