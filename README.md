## In this project, I want to download history data and make a dataset for the Tehran Stock Exchange (TSE). TSE dont share all data into internet free

## Iran stock websites:
- [بورس اوراق بهادار تهران](http://tse.ir/)
- [پایگاه خبری بازار سرمایه ایران](http://www.sena.ir/)
- [سامانه جامع اطلاع رسانی ناشران](https://www.codal.ir/)
- [سازمان بورس و اوراق](https://www.seo.ir/)
- [قیمت های بورس](http://www.tsetmc.com)

## Example
For test select bank melat symbol:

[Main Page](http://www.tsetmc.com/Loader.aspx?ParTree=15)
[بانك ملت (وبملت)](http://www.tsetmc.com/Loader.aspx?ParTree=151311&i=778253364357513#)

	Bank Melat SYMBOL_ID = 778253364357513

### Today Data
	URI
	http://www.tsetmc.com/Loader.aspx?ParTree=151311&i=SYMBOL_ID

	Sample
	http://www.tsetmc.com/Loader.aspx?ParTree=151311&i=778253364357513

### Get History Data
	URI
	http://cdn.tsetmc.com/Loader.aspx?ParTree=15131P&i=SYMBOL_ID&d=YEAR,MONTH,DAY
	Sample:
	http://cdn.tsetmc.com/Loader.aspx?ParTree=15131P&i=778253364357513&d=20180212

The TSETMC website developers use a javascript function with name ens for adding javascript files into HTML document.

Three javascript files used for handled HTML functionality:
- http://cdn.tsetmc.com/tsev2/res/loader.aspx?t=j&_443
- http://cdn.tsetmc.com/tsev2/res/loader.aspx?t=s&_443
- http://cdn.tsetmc.com/tsev2/res/loader.aspx?t=h&_443

In HTML file defined variables witcch used in javascript functions

	var InstSimpleData = [
						0 'بانك ملت',
						1 'وبملت',
						2 'بازار بورس',
						3 'بازار اول (تابلوي اصلي) بورس',
						4 1,
						5 'N1',
						6 'IRO1BMLT0007',
						7 'IRO1BMLT0001',
						8 50000000000,
						9 9569378
						];
	var LVal30         = InstSimpleData[0]; **SYMBOL_NAME**
	var LVal18AFC      = InstSimpleData[1]; **SYMBOL**
	var FlowName       = InstSimpleData[3]; **TABLUE***
	var Flow           = InstSimpleData[4]; **???***
	var CgrValCot      = InstSimpleData[5]; **???***
	var InstrumentID   = InstSimpleData[7]; **???***
	var ZTitad         = InstSimpleData[8]; **???***
	var BaseVol        = InstSimpleData[9]; **???***
	var InsCode        = '778253364357513'; **SYMBOL_ID**
	var CIsin          = '';
	var PdrCotVal      = '';
	var PClosing       = ''; 
	var DEven          = '20180212';


### Analysis HTML and Javascript Files
	StaticTreshholdData
		[
			[1,2497.00, 2261.00],
			[60124, 2483.00, 2247.00]
		]
	ClosingPriceData
		[
		C1	آخرین معامله
		C2	قیمت پایانی
		C3	اولین قیمت
		C4	قیمت دیروز

		DateTime               X   C1     C2     C3     C4     Low    High  ID   C5       C6
		'1397/11/17 09:00:20','-','2430','2367','2430','2365','2430','2430','1','100000','243000000','0','90020'
		'1397/11/17 09:00:20','-','2430','2368','2430','2365','2430','2430','2','200000','486000000','0','90020'
		'1397/11/17 09:00:20','-','2430','2370','2430','2365','2430','2430','3','300000','729000000','0','90020'
		'1397/11/17 09:00:20','-','2430','2372','2430','2365','2430','2430','4','400000','972000000','0','90020'

		'1397/11/17 09:00:21','-','2430','2373','2430','2365','2430','2430','5','500000','1215000000','0','90021'
		'1397/11/17 09:00:21','-','2430','2374','2430','2365','2430','2430','6','570000','1385100000','0','90021'
		'1397/11/17 09:00:21','-','2430','2375','2430','2365','2430','2430','7','623044','1513996920','0','90021'
		'1397/11/17 09:00:21','-','2430','2376','2430','2365','2430','2430','8','673044','1635496920','0','90021'
		'1397/11/17 09:00:21','-','2430','2377','2430','2365','2430','2430','9','723044','1756996920','0','90021'

		'1397/11/17 09:00:21','-','2430','2378','2430','2365','2430','2430','10','773044','1878496920','0','90021'
		'1397/11/17 09:00:21','-','2430','2378','2430','2365','2430','2430','11','808544','1964761920','0','90021'
		'1397/11/17 09:00:21','-','2430','2379','2430','2365','2430','2430','12','840044','2041306920','0','90021'
		'1397/11/17 09:00:21','-','2430','2379','2430','2365','2430','2430','13','860044','2089906920','0','90021'

	
ii.OneDayBL = BestLimitData
	#blhb خرید
	#blhs فروش	
	زمان  تعداد  حجم  قیمت

	var BestLimitData =
		[
			2,3,4
			5,6,7
			   0    1   2     3       4      5      6     7
					Buyer               Seller
				   ------------------   ----------------
			            cnt  vol     price  price   vol   cnt
			[60122,'1','1','16145', '2371','2400','9000', '2'],
			[60122,'2','6','550000','2322','2430','1000', '1'],
			[60122,'3','2','947',   '2310','2440','10000','1'],
			[60122,'4','1','100000','2308','2445','50000','1'],
			[60122,'5','1','10000', '2306','2447','50500','2'],

			[83007,'2','1','5000',  '2350','2430','1000', '1'],
			[83007,'3','6','550000','2322','2440','10000','1'],
			[83007,'4','2','947',   '2310','2445','50000','1'],
			[83007,'5','1','100000','2308','2447','50500','2'],

			[83052,'1','1','16145', '2371','2400','9376', '3'],

			[83107,'2','1','5000',  '2350','2424','30000','1'],
			[83107,'3','6','550000','2322','2430','1000', '1'],
			[83107,'4','2','947',   '2310','2440','10000','1'],
			[83107,'5','1','100000','2308','2445','50000','1'],

			[83110,'4','2','947',   '2310','2440','20000','2'],
			[83142,'2','2','6524',  '2350','2424','30000','1'],
			[83152,'1','1','16145', '2371','2396','934',  '1'],
			[83152,'2','2','6524',  '2350','2400','9376', '3'],
			[83152,'3','6','550000','2322','2424','30000','1'],
			[83152,'4','2','947',   '2310','2430','1000', '1'],
			[83152,'5','1','100000','2308','2440','20000','2'],
			[83206,'3','6','550000','2322','2423','1000', '1'],
			[83206,'4','2','947',   '2310','2424','30000','1'],
			[83227,'4','1','50000', '2320','2424','30000','1'],
			[83227,'5','2','947',   '2310','2440','20000','2'],
			[83252,'3','6','550000','2322','2410','500',  '1'],
			[83252,'4','1','50000', '2320','2423','1000', '1'],
			[83252,'5','2','947',   '2310','2424','30000','1'],
		]
ii.OneDayCP = ClosingPriceData
	ClosingPriceData=[
			['1397/11/21 06:10:55','-','2380','2396','0',   '2396','0',   '0',   '0','0',    '0',        '0','61055'],
			['1397/11/21 09:00:22','-','2390','2396','2390','2396','2390','2390','1','20000','47800000', '0','90022'],
			['1397/11/21 09:00:22','-','2390','2396','2390','2396','2390','2390','2','21500','51385000', '0','90022'],
			['1397/11/21 09:00:59','-','2381','2396','2390','2396','2390','2381','3','23500','56147000', '0','90059'],
			['1397/11/21 09:00:59','-','2381','2396','2390','2396','2390','2381','4','53500','127577000','0','90059'],
			['1397/11/21 09:00:59','-','2381','2396','2390','2396','2390','2381','5','73500','175197000','0','90059'],

ii.OneDayTH = StaticTreshholdData
ii.OneDayIS = InstrumentStateData
ii.OneDayIT = IntraTradeData
ii.OneDaySH = ShareHolderData
ii.OneDaySY = ShareHolderDataYesterday
